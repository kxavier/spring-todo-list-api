# Spring Todo-List API
The Udemy Advanced Web Developer Course presents a Node.js API for a simple list of todo activities application. This project is a Java version of the API using the following technologies:
* Spring Boot
* Jersey JAX-RS
* Spring Data MongoDB

The next sections describe how to run the project and explains parts of the code, for those that are new to the technologies used.

## Running the project
To run the project you need the following tools installed:
* Java
* Git
* Docker or MongoDB database

Follow these steps to build the binaries from the source and run the application:
1. clone the application from GitHub

`git clone https://github.com/kxavier/spring-todo-list-api.git`

2. Generate the uber jar with the binaries of the application

If you have Maven installed just open a terminal on the same folder as the pom.xml file and type `mvn package` , otherwise type `.\mvnw package` on Linux or `mvnw.cmd package` on Windows.

3. Start the MongoDB database. With docker you can use the following instruction on a terminal:

`docker run -d -p 27017:27017 --name mongo mongodb:3.2.20-jessie`

4. Run the application

`java -jar target/spring-todo-list-api.jar`

To make requests for the API you can use tools like Postman or cUrl, or you can create a client application with JavaScript or the language of your choice. The requests can be made to http://localhost:8080/api.

The operations that are implemented for the API and their corresponding URLs are:

Description | HTTP verb |URL template
------------| --------- |------------
get all the todo itens | GET | /todos
get a todo by id | GET | /todos/:todoId
insert a new todo | POST | /todos
update a todo | PUT | /todos/:todoId
delete a todo | DELETE | /todos/:todoId
 
## Using Spring Boot
Spring Boot is a framework that speeds the development of applications by applying default configurations. We can access [Spring Initializr](https://start.spring.io/) to select the required dependencies and generate the skeleton of a Maven project for the application.

The Maven project generated by the starter site already contains some configurations on the pom.xml of the project to enable the use of Spring Boot.

Configuration for the Maven Spring Boot Plugin
```xml
<plugin>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-maven-plugin</artifactId>
</plugin>
```
This plugin will find all the needed dependency jars and package them in an uber jar for the application.

Configuration of a parent project with the dependency versions for the spring boot starters
```xml
<parent>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-parent</artifactId>
  <version>2.0.1.RELEASE</version>
  <relativePath/> <!-- lookup parent from repository -->
</parent>
```

The Spring Boot application needs a main class that will start the server that will host the API code. In our project this is the *xavier.kleber.todolist.spring.SpringTodoListApiApplication* class, that is annotated with *@SpringBootApplication* and starts the applications using the static method *SpringApplication.run*.

```java
@SpringBootApplication
public class SpringTodoListApiApplication{

	public static void main(String[] args) {
		SpringApplication.run(SpringTodoListApiApplication.class, args);
	}
}
```

The *@SpringBootApplication* annotation groups several other convenient Spring annotations that enable the automatic discovery of beans(*@ComponentScan*), marks this class as a source of configuration(*@Configuration*) and apply several automatic default configurations(*EnableAutoConfiguration*).

PS: The beans to be discovered must be located in the same package or sub-packages of the *SpringTodoListApiApplication* class

Some custom configuration can be applied using special properties on the *application.properties* file located in the *src/main/resources* folder.

## Using Jersey JAX-RS
JAX-RS is a Java specification that enables the creation of Restful Web Service Endpoints (APIs). Jersey is the reference implementation of the JAX-RS API and to enable its use with Spring Boot we need a dependency configuration in the pom.xml file of the project.

```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-jersey</artifactId>
</dependency>
```

The default JAX-RS configuration is not supported by the jersey starter in Spring Boot, so we use the custom Jersey configuration that requirese the following steps:
* create a configuration class as a subclass of *org.glassfish.jersey.server.ResourceConfig*
* register the resource classes (Restful endpoints) inside the constructor of our configuration class using the *register* method
* annotate the class with *@Component* or *@Configuration*
* optionally annotate the class with *@ApplicationPath* to define the prefix used to access the resources

```java
@Configuration
@ApplicationPath("/api")
public class JAXRSConfig extends ResourceConfig {
    public JAXRSConfig() {
        register(TodosResource.class);
        register(CorsResponseFilter.class);
    }
}
```

### CORS Support
Cross-origin Request Sharing(CQRS) is a mechanism to enable the browser to send requests for resources that do not originate from the same origin as the main application loaded. We need to enable it in our application to allow JavaScript clients from any application to access our API.

To support CORS with JAX-RS we added a dependency in our pom.xml and registered the *CorsResponseFilter.class* in our Jersey configuration class.

```xml
<dependency>
  <groupId>com.airhacks</groupId>
  <artifactId>jaxrs-cors</artifactId>
  <version>0.0.2</version>
</dependency>
```

PS: to use this dependency in a standard JAX-RS project no extra-configuration is needed because the filter self registers.

## Using Spring Data MongoDB
Spring Data enables the fast creation of classes to access databases using an abstraction to reduce the amount of code that needs to be written. It defines a *Repository* interface as a marker for the abstraction of the access to persistent stores.

To enable the use of Spring Data to access MongoDB a dependency needs to be added to the pom.xml file of the project.
```xml
<dependency>
  <groupId>org.springframework.boot</groupId>
  <artifactId>spring-boot-starter-data-mongodb</artifactId>
</dependency>
```

To create a repository class to access MongoDB the following steps are needed:
* create an interface that extends *MongoRepository* and defines the type of the entity and of its key
* Declare in the interface the required query methods. Spring Data will generate the methods following a naming convention where the name of the method includes the fields or columns to be used as parameters for the query.

In our project there will be only a query by id so the interface remains empty.
```java
public interface TodoRepository extends MongoRepository<Todo,String>{
}
```
The entity class is annotated with *@Document*, *@Id* and *@Field* to configure the collection where the data is stored and the name of the fields when they are different from the names in the class.

Snippet of the Todo.class
```java
//Maps the collection name in MongoDB
@Document(collection = "todos")
public class Todo {

    //Maps the _id field in the mongo document
    @Id
    private String id;
    private String name;
    private boolean completed;
    // Maps the field name used in the mongo document
    @Field("created_date")
    private Date createdDate = new Date();
```
There is also a configuration of the database that should be used in mongodb. This configuration is done in the *application.properties* file.

`spring.data.mongodb.uri=mongodb://localhost/todo-api`
